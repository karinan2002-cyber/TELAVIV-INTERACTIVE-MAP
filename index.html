<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="utf-8">
<title>מפת גינות – שאלון איכויות</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
  margin:0;
  direction:rtl;
  font-family:sans-serif;
}
#map {
  height:100vh;
  width:100%;
}

/* ===== MARKERS ===== */
.marker-thumb {
  width:64px;
  height:64px;
  border-radius:50%;
  border:2px solid white;
  overflow:hidden;
  background:#4CAF50;
  box-shadow:0 0 4px rgba(0,0,0,.4);
}
.marker-thumb img {
  width:100%;
  height:100%;
  object-fit:contain;
}

/* ===== POPUP ===== */
.popup {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:white;
  padding:16px;
  border-radius:16px;
  width:90%;
  max-width:360px;
  display:none;
  z-index:9999;
}
.popup.show { display:block; }
.popup img {
  width:120px;
  height:120px;
  object-fit:contain;
  border-radius:50%;
  display:block;
  margin:auto;
}
.popup label { display:block; margin:4px 0; }
button {
  background:#388E3C;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="map"></div>

<div id="popup" class="popup">
  <h3 id="popup-title"></h3>
  <img id="popup-img">
  <div id="popup-options"></div>
  <button onclick="closePopup()">סגור</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== GOOGLE SHEETS ===== */
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbyom4ORO0eatLuYOOL8U0H89aUWAp0iWlwVqoSZ2NTrRtWgPycwGJOQwIiz3SKC-mFQ/exec";

/* ===== MAP ===== */
const map = L.map('map').setView([32.125, 34.802], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

/* ===== DATA ===== */
const qualities = [
  "נוף יפה","מרחב טבע","שקט ושלווה",
  "פארק אטרקטיבי","רועש","מפחיד"
];

const parksData = [
{"name":"גן רוזין","lat":32.126187,"lon":34.803838},
{"name":"גן אלפרד ביר","lat":32.126725,"lon":34.799704},
{"name":"מרכז קהילתי רוזין","lat":32.126956,"lon":34.804118},
{"name":"מרכז אלרם-שוסטר","lat":32.125162,"lon":34.803658},
{"name":"קאנטרי גימל","lat":32.127565,"lon":34.803042},
{"name":"גן הפסל","lat":32.126009,"lon":34.797823},
{"name":"גן פיינשטיין","lat":32.127806,"lon":34.798541},
{"name":"גן מלקינד","lat":32.128201,"lon":34.796766},
{"name":"קאנטרי ברזני","lat":32.127002,"lon":34.79673},
{"name":"חורשת דרזנר","lat":32.128074,"lon":34.80637},
{"name":"גן יהודה ליש","lat":32.125499,"lon":34.805951},
{"name":"גן כצנלסון","lat":32.12366,"lon":34.79953},
{"name":"גן בויאר","lat":32.12335,"lon":34.795436},
{"name":"גן המייסדים","lat":32.129443,"lon":34.791957},
{"name":"גן אביגור אזורי חן","lat":32.129959,"lon":34.794299},
{"name":"גינת בוסתן המינים","lat":32.129725,"lon":34.792718},
{"name":"גינת מוקדי","lat":32.128172,"lon":34.793628},
{"name":"גן שניצר","lat":32.126109,"lon":34.793089},
{"name":"מגרש סמבורסקי","lat":32.126767,"lon":34.793759},
{"name":"גינת ברלין","lat":32.124129,"lon":34.79287},
{"name":"קאנטרי אזורי חן","lat":32.130632,"lon":34.792803},
{"name":"גינת אלכסנדר פן","lat":32.123369,"lon":34.811476},
{"name":"גינת מיקדו","lat":32.122888,"lon":34.815628},
{"name":"גן שורר חיים","lat":32.122829,"lon":34.811449},
{"name":"גן בית צורי","lat":32.123113,"lon":34.801535},
{"name":"גן ליאון רקנאטי","lat":32.122733,"lon":34.80345},
{"name":"גינת ברקאי","lat":32.124014,"lon":34.806495},
{"name":"גינת הרוחות","lat":32.12349,"lon":34.816723}
];

/* ===== FUNCTIONS ===== */
function iconFor(name){
  return L.divIcon({
    className:"",
    html:`<div class="marker-thumb">
      <img src="images/${name}.jpg"
      onerror="this.style.display='none'">
    </div>`
  });
}

function sendData(park, quality){
  fetch(SCRIPT_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      parkName:park,
      quality:quality,
      userId:localStorage.userId ||= Math.random().toString(36).slice(2)
    })
  });
}

function openPopup(park){
  const p=document.getElementById("popup");
  document.getElementById("popup-title").innerText=park;
  document.getElementById("popup-img").src=`images/${park}.jpg`;

  const opts=document.getElementById("popup-options");
  opts.innerHTML="";
  qualities.forEach(q=>{
    opts.innerHTML+=`
      <label>
        <input type="checkbox" onchange="sendData('${park}','${q}')">
        ${q}
      </label>`;
  });
  p.classList.add("show");
}
function closePopup(){
  document.getElementById("popup").classList.remove("show");
}

/* ===== MARKERS ===== */
parksData.forEach(p=>{
  const m=L.marker([p.lat,p.lon],{icon:iconFor(p.name)}).addTo(map);
  m.on("click",()=>openPopup(p.name));
});
</script>

</body>
</html>
