<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="utf-8" />
    <title>מפת גינות ובתי קפה – שאלון איכויות</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            direction: rtl;
            font-family: sans-serif;
            overflow: hidden;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        .popup-container {
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 16px 20px;
            border-radius: 16px;
            width: 90%;
            max-width: 360px;
            z-index: 9999;
            text-align: right;
            color: #000;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            display: none;
            opacity: 0;
            transition: all 0.3s ease-in-out;
        }
        .popup-container.show {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        .popup-container h4 {
            margin: 6px 0;
            font-size: 1.1em;
        }
        .popup-container p.question {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1em;
        }
        .popup-container img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: contain !important;
            background-color: #fff;
            border: 2px solid #ddd;
            margin: 8px auto;
            display: block;
            transform: scale(1.2);
        }
        .popup-container label {
            display: block;
            margin: 4px 0;
            font-size: 0.95em;
        }
        .popup-container textarea {
            width: 90%;
            border-radius: 4px;
            padding: 4px;
            margin-top: 4px;
            font-family: inherit;
            display: block;
            transform: scale(1.2);
        }
        .popup-container button {
            background-color: #388E3C;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            margin: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        .popup-container button:hover {
            background-color: #2e7d32;
        }
        .save-msg {
            display: none;
            font-weight: bold;
            margin-top: 8px;
            color: #388E3C;
        }
        #nickname-popup input {
            width: 90%;
            padding: 6px;
            border-radius: 6px;
            margin-top: 6px;
            font-size: 1em;
            font-family: inherit;
        }
        #nickname-popup p {
            font-size: 1em;
            margin-bottom: 6px;
        }

        #main-question {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 360px;
            z-index: 9999;
            text-align: center;
            font-size: 0.95em;
            color: #000;
            transition: all 0.3s ease;
        }
        #main-question.hide {
            opacity: 1;
            transform: translate(-50%, 0);
            pointer-events: auto;
        }
    </style>
</head>
<body>

    <!-- שאלת פתיחה -->
    <div id="main-question">
        <strong>אילו איכויות יש למרחבים הציבוריים הירוקים בסביבת המגורים שלכם?</strong><br>
        אנא לחצו על תמונה וענו על השאלה.
    </div>

<div id="popup" class="popup-container">
  <h4 id="popup-title"></h4>
  <img id="popup-img" src="">
  <div id="checkboxes"></div>
  <div id="additional-question" style="display:none;">
    <p><strong>האם יש למקום איכויות נוספות?</strong></p>
    <button id="yes-btn">כן</button>
    <button id="no-btn">לא</button>
  </div>
  <div id="save-msg" style="display:none; font-weight:bold; color:#388E3C;">✔ נשמר!</div>
</div>

<div id="check-icon" class="confirm-icon">✔</div>
<button id="finish-btn">סיום שאלון</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ----- נתוני הגינות -----
const parksData = [
  {"name":"גן רוזין","lat":32.126187,"lon":34.803838},
  {"name":"גן אלפרד ביר","lat":32.126725,"lon":34.799704},
  {"name":"מרכז קהילתי רוזין","lat":32.126956,"lon":34.804118},
  {"name":"מרכז אלרם-שוסטר","lat":32.125162,"lon":34.803658},
  {"name":"קאנטרי גימל","lat":32.127565,"lon":34.803042},
  {"name":"גן הפסל","lat":32.126009,"lon":34.797823},
  {"name":"גן פיינשטיין","lat":32.127806,"lon":34.798541},
  {"name":"גן מלקינד","lat":32.128201,"lon":34.796766},
  {"name":"קאנטרי ברזני","lat":32.127002,"lon":34.796730},
  {"name":"חורשת דרזנר","lat":32.128074,"lon":34.806370},
  {"name":"גן יהודה ליש","lat":32.125499,"lon":34.805951},
  {"name":"גן כצנלסון","lat":32.123660,"lon":34.799530},
  {"name":"גן בויאר","lat":32.123350,"lon":34.795436},
  {"name":"גן המייסדים","lat":32.129443,"lon":34.791957},
  {"name":"גן אביגור-אזורי חן","lat":32.129959,"lon":34.794299},
  {"name":"גינת בוסתן המינים","lat":32.129725,"lon":34.792718},
  {"name":"גינת מוקדי","lat":32.128172,"lon":34.793628},
  {"name":"גן שניצר","lat":32.126109,"lon":34.793089},
  {"name":"מגרש סמבורסקי","lat":32.126767,"lon":34.793759},
  {"name":"גינת ברלין","lat":32.124129,"lon":34.792870},
  {"name":"קאנטרי אזורי חן","lat":32.130632,"lon":34.792803},
  {"name":"גינת אלכסנדר פן","lat":32.123369,"lon":34.811476},
  {"name":"גינת מיקדו","lat":32.122888,"lon":34.815628},
  {"name":"גן שורר חיים","lat":32.122829,"lon":34.811449},
  {"name":"גן בית צורי","lat":32.123113,"lon":34.801535},
  {"name":"גן ליאון רקנאטי","lat":32.122733,"lon":34.803450},
  {"name":"גינת ברקאי","lat":32.124014,"lon":34.806495},
  {"name":"גינת הרוחות","lat":32.123490,"lon":34.816723},
  {"name":"חוף הים טיילת","lat":32.12360,"lon":34.78343}
];

const qualities = [
  "נוף יפה","מרחב טבע","הרגשה של יער","חופש ומרחב","פארק אטרקטיבי",
  "שקט ושלווה","אזור עם מתקנים לפעילויות","היסטוריה ותרבות","אתר טבע חשוב",
  "לא נעים","מפחיד","רועש","איכות אחרת – כתבו כאן:"
];

// ----- יצירת המפה -----
const map = L.map("map");
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

// ----- פונקציה ליצירת אייקון marker -----
function createIcon(name, active=false){
  const border = active ? "#00C853":"white";
  const bg = active ? "#C8E6C9":"#4CAF50";
  return L.divIcon({
    className:"",
    html:`<div class="marker-thumb" style="border-color:${border};background:${bg};">
            <img src="images/${name}.jpg" onerror="this.style.display='none';this.parentElement.style.backgroundColor='#228B22';">
          </div>`
  });
}

// ----- אלמנטים של פופאפ -----
const popup = document.getElementById("popup");
const title = document.getElementById("popup-title");
const img = document.getElementById("popup-img");
const checkboxesDiv = document.getElementById("checkboxes");
const additionalQ = document.getElementById("additional-question");
const yesBtn = document.getElementById("yes-btn");
const noBtn = document.getElementById("no-btn");
const saveMsg = document.getElementById("save-msg");
const checkIcon = document.getElementById("check-icon");
const finishBtn = document.getElementById("finish-btn");

let selectedParks = 0;

// ----- יצירת markers לכל הגינות -----
parksData.forEach(p=>{
  const marker = L.marker([p.lat,p.lon], {icon:createIcon(p.name,false)}).addTo(map);

  marker.on("click", ()=>{
    title.textContent=p.name;
    img.src=`images/${p.name}.jpg`;
    checkboxesDiv.innerHTML="";
    additionalQ.style.display="none";
    saveMsg.style.display="none";

    qualities.forEach(q=>{
      if(q.includes("איכות אחרת")){
        checkboxesDiv.innerHTML+=
          `<label><input type="checkbox" value="${q}"> ${q}</label>
           <textarea class="other-text" placeholder="כתבו כאן..." rows="2"></textarea>`;
      } else {
        checkboxesDiv.innerHTML+=`<label><input type="checkbox" value="${q}"> ${q}</label>`;
      }
    });

    popup.classList.add("show");

    const checkboxes = checkboxesDiv.querySelectorAll("input[type='checkbox']");
    const otherField = checkboxesDiv.querySelector(".other-text");

    checkboxes.forEach(chk=>{
      chk.onchange=()=>{
        const anyChecked = [...checkboxes].some(c=>c.checked);
        if(!p.hasSelection && anyChecked) selectedParks++;
        p.hasSelection = anyChecked;
        marker.setIcon(createIcon(p.name, anyChecked));
        if(anyChecked){ 
          checkIcon.classList.add("show"); 
          setTimeout(()=>{ checkIcon.classList.remove("show"); additionalQ.style.display="block"; },800);
        }
        if(selectedParks>=1) finishBtn.classList.add("ready");
      };
    });

    yesBtn.onclick=()=>additionalQ.style.display="none";
    noBtn.onclick=()=>{
      additionalQ.style.display="none";
      saveMsg.style.display="block";
      setTimeout(()=>popup.classList.remove("show"),1500);
    };
  });
});

// ----- התאמת התצוגה לכל הגינות והחוף -----
map.setView([32.127, 34.798], 15);

// ----- לחצן סיום -----
finishBtn.onclick=()=>{ 
  if(selectedParks>=1) alert("תודה שסיימתם את השאלון!"); 
};
</script>
</body>
</html>



